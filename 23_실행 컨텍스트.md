# 23장 실행 컨텍스트

# 1. 소스코드

> #### `소스코드 타입`에 따라 실행 컨텍스트 생성 또는 관리하는 내용이 다르므로 구분을 함.
 
그렇다면 `소스코드 타입`에는 어떤 종류가 있는지 알아보자.
 

<br/>

## 1-2. 소스코드 타입

> ### 1) 전역 코드 

- 최상위 스코프인 전역 스코프 생성.
- 전역 코드 평가시에 전역 실행 컨텍스트 생성.
<br/>

> ### 2) 함수 코드 

- 지역 스코프 생성.
- 전역 스코프에서 시작하는 스코프 체인의 일원으로 연결.
- 함수 코드 평가시에 함수 실행 컨텍스트 생성.
<br/>

> ### 3) eval 코드 

- strict mode에서 독자적인 스코프 생성
- eval 코드 평가시에 eval 실행 컨텍스트 생성
<br/>

> ### 4) 모듈 코드 

- 모듈별로 독립적인 모듈 스코프 생성 
- 모듈 코드 평가시에 모듈 실행 컨텍스트 생성
<br/>

<br/><hr/>
 

 

# 2. 소스코드 평가 & 실행


> ### 소스코드 평과 과정

- 실행 컨택스트를 생성하고 변수, 함수의 선언문만 우선 실행하여 생성된 변수나 함수 식별자를 키로 실행 컨택스트가 관리하는 스코프에 등록함.


> ### 소스코드 평과 과정

- 소스코드의 평가과정이 끝나면 선언문을 제외한 소스코드가 순차적으로 실행됨.
- 변수나 함수의 참조, 즉 소스코드 실행에 필요한 정보를 실행 컨택스트가 관리하는 스코프에서 검색해 취득.


<br/><hr/>
 

# 3. 렉시컬 환경

> 식별자와 식별자에 바인딩된 값, 그리고 상위 스코프에 대한 참조를 기록하는 자료구조이자, 실행 컨텍스트를 구성하는 컴포넌트.

- 키와 값을 갖는 객체 형태의 스코프를 생성해 식별자를 키로 등록하고 식별자에 바인딩된 값을 관리함.
- 또한 렉시컬 환경은 스코프를 구분해 식별자를 등록하고 관리하는 저장소 역할을 하는 `렉시컬 스코프`의 실체라고 할 수 있음.


<br/><br/>

## 3-2. 렉시컬 환경을 구성하는 요소

> ### 1) 환경 레코드 
식별자를 등록하고 바인딩 된 값을 관리하는 저장소.

> ### 2) 외부 렉시컬 환경에 대한 참조 
상위 스코프를 가리킴. (상위 코드의 렉시컬 환경)


<br/><hr/>

# 4. 실행 컨텍스트 생성과 식별자 검색

```js
1) 전역 객체 생성

2) 전역 코드 평가

    * 평가 순서 * 

     1. 전역 실행 컨텍스트 생성

     2. 전역 렉시컬 환경 생성

            1) 전역 환경 레코드 생성

                  1.1) 객체 환경 레코드 생성

                  1.2) 선언적 환경 레코드 생성

            2) this 바인딩

            3) 외부 렉시컬 환경에 대한 참조 결정

 

3) 전역 코드 실행

4) 함수 코드 평가

    * 평가 순서 * 

     1. 함수 실행 컨텍스트 생성

     2. 함수 렉시컬 환경 생성

            1) 함수 환경 레코드 생성

            2) this 바인딩

            3) 외부 렉시컬 환경에 대한 참조 결정

5) 함수 코드 실행

6) 함수 코드 실행 종료

7) 전역 코드 실행 종료

```

<br/><hr/>

# 5. 전역 코드 평가

> ### 1) 전역 실행 컨텍스트 생성 

- 빈 `전역 실행 컨텍스트`를 `생성`, `실행 컨텍스트 스택`에 `push`

<br/>

> ### 2) 전역 렉시컬 환경 생성 

- `전역 렉시컬 환경`을 `생성`하고 전역 `실행 컨텍스트`에 `바인딩`함.

<br/>

> #### 2-1) 전역 환경 레코드 생성 

- `전역 환경 레코드`의 `객체 환경 레코드`와 `선언적 환경 레코드`는 서로 협력하여` 전역 스코프`와 `전역 객체`를 `관리`함.

<br/>


> ##### 2-1-1) 객체 환경 레코드 생성

- 전역 코드 평가 과정에서 var 키워드로 선언한 전역 변수와 함수 선언문으로 정의된 전역 함수는 전역 환경 레코드의 객체 환경 레코드에 연결된 BindObject를 통해 전역 객체의 프로퍼티와 메서드가 됨.

- 함수 선언문으로 정의한 함수가 편가되면 함수 이름과 동일한 이름의 식별자를 객체 환경 레코드에 바인딩된 BindObject를 통해 전역 객체에 키로 등록하고 생성된 함수 객체를 즉시 할당함. 따라서, 변수와 달리 함수는 함수 선언문 이전에 호출 가능함.

> #####  2-1-2) 선언적 환경 레코드 생성

- `let` 또는 `const` 키워드로 선언한 전역 변수는 선언적 환경 레코드에 등록되고 관리됨.

- 전역 객체의 프로퍼티가 되지 않아 런타임에 실행 흐름이 변수 선언문에 도달하기 전까지 일시적 사각지대에 빠지게 됨.

<br/><br/><br/>




> #### 2-2) this 바인딩

전역 환경 레코드의 `[[GlobalThisValue]]` 내부 슬롯에 this가 바인딩됨.
<br/>

> #### 2-3) 외부 렉시컬 환경에 대한 참조 결정

- 현재 평가 중인 소스코드를 포함하는 상위 스코프를 가리키며, 
전역 코드를 포함하는 소스코드는 없기 때문에 `null`이 할당됨
